<?xml version="1.0"?>
<project name="Girinoscope" default="build" basedir="..">

	<echo message="OS Name is:         ${os.name}" />
	<echo message="OS Architecture is: ${os.arch}" />
	<echo message="OS Version is:      ${os.version}" />

	<condition property="platform" value="macosx">
		<os family="mac" />
	</condition>
	<condition property="platform" value="windows">
		<os family="windows" />
	</condition>
	<condition property="platform" value="linux">
		<os family="unix" />
	</condition>

	<!-- ================================================================ -->

	<property name="app.name" value="${ant.project.name}" />
    <property name="app.version" value="1.0.0" />

	<property name="target.dir" value="${basedir}/target" />

	<!-- ================================================================ -->

	<target name="clean" description="Perform a spring cleaning">
		<delete dir="${basedir}/target" />
	</target>

	<target name="build" description="Build.">
		<mkdir dir="${target.dir}" />
		<mkdir dir="${target.dir}/classes" />

		<path id="compile.classpath.id">
			<fileset dir="${basedir}/lib" includes="*.jar" />
		</path>

		<javac srcdir="${basedir}/src" destdir="${target.dir}/classes" classpathref="compile.classpath.id" source="1.6" target="1.6" debug="on" />
        <copy todir="${target.dir}/classes">
            <fileset dir="${basedir}/src" excludes="*.java" />
        </copy>

		<jar destfile="${target.dir}/lib/${app.name}.jar">
			<fileset dir="${target.dir}/classes" />
			<manifest>
				<attribute name="Main-Class" value="org.hihan.${app.name}.UI" />
			</manifest>
		</jar>

        <copy todir="${target.dir}/lib">
            <fileset dir="${basedir}/lib" includes="*.jar" />
        </copy>

		<ant target="build" inheritAll="false" antfile="${basedir}/build/${platform}/build.xml">
			<property name="app.name" value="${app.name}" />
		</ant>
	</target>

	<target name="dist" depends="build" description="Build for distribution.">
		<ant target="dist" inheritAll="false" antfile="${basedir}/build/${platform}/build.xml">
			<property name="app.name" value="${app.name}" />
			<property name="app.version" value="${app.version}" />
			<property name="app.revision" value="${app.version}" />
		</ant>
	</target>

</project>
